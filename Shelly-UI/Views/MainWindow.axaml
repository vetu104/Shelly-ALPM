<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Shelly_UI.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:icons="using:Material.Icons.Avalonia"
        xmlns:avalonia="http://reactiveui.net"
        xmlns:shellyUi="clr-namespace:Shelly_UI"
        xmlns:converters="clr-namespace:Shelly_UI.Converters"
        xmlns:enums="clr-namespace:Shelly_UI.Enums"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="Shelly_UI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        x:CompileBindings="True"
        Icon="/Assets/shellylogo.png"
        Title="Shelly"
        MinHeight="600"
        MinWidth="800"
        Width="800"
        Height="600">

    <Window.Styles>
        <Style Selector="ToggleButton#ManagementToggle:pointerover /template/ Border">
            <Setter Property="Background" Value="#1AFFFFFF" />
        </Style>
    </Window.Styles>
    <Window.Resources>
        <converters:EnumEqualsConverter x:Key="EnumEqualsConverter" />
            <StreamGeometry x:Key="FlatpakIcon">M12 0c-0.556 0 -1.111 0.144 -1.61 0.432l-7.603 4.39a3.217 3.217 0 0 0 -1.61 2.788v8.78c0 1.151 0.612 2.212 1.61 2.788l7.603 4.39a3.217 3.217 0 0 0 3.22 0l7.603 -4.39a3.217 3.217 0 0 0 1.61 -2.788V7.61a3.217 3.217 0 0 0 -1.61 -2.788L13.61 0.432A3.218 3.218 0 0 0 12 0Zm0 2.358c0.15 0 0.299 0.039 0.431 0.115l7.604 4.39c0.132 0.077 0.24 0.187 0.315 0.316L12 12v9.642a0.863 0.863 0 0 1 -0.431 -0.116l-7.604 -4.39a0.866 0.866 0 0 1 -0.431 -0.746V7.61c0 -0.153 0.041 -0.302 0.116 -0.43L12 12Z</StreamGeometry>
    </Window.Resources>
    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Grid>
        <SplitView IsPaneOpen="{Binding IsPaneOpen}"
                   CompactPaneLength="66"
                   DisplayMode="CompactInline"
                   OpenPaneLength="200"
                   PaneBackground="{DynamicResource SystemChromeMediumColor}">
            <SplitView.Pane>
                <Grid>
                    <StackPanel Spacing="5">
                        <Button Command="{Binding TogglePane}"
                                HorizontalAlignment="Left"
                                Background="Transparent"
                                Width="66" Height="48"
                                Padding="0">
                            <icons:MaterialIcon Kind="Menu" Width="24" Height="24" HorizontalAlignment="Center" />
                        </Button>
                        <Button Command="{Binding GoHome}"
                                HorizontalAlignment="Stretch"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="0">
                            <Grid ColumnDefinitions="66, *" Height="40" Background="Transparent">
                                <icons:MaterialIcon Kind="Home" Width="24" Height="24" HorizontalAlignment="Center"
                                                    VerticalAlignment="Center" />
                                <TextBlock Grid.Column="1" Text="Home" VerticalAlignment="Center"
                                           IsVisible="{Binding $parent[SplitView].IsPaneOpen}" />
                            </Grid>
                        </Button>
                        <Button Command="{Binding TogglePackageMenu}"
                                HorizontalAlignment="Stretch"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="0">
                            <Grid ColumnDefinitions="66, *" Height="40">
                                <icons:MaterialIcon Kind="PackageVariant" Width="22" Height="22"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center" />
                                <TextBlock Grid.Column="1" Text="Packages"
                                           VerticalAlignment="Center"
                                           IsVisible="{Binding $parent[SplitView].IsPaneOpen}" />
                            </Grid>
                        </Button>
                        <StackPanel Margin="25,0,0,10" Spacing="5"
                                    HorizontalAlignment="Left">
                            <StackPanel.IsVisible>
                                <MultiBinding Converter="{x:Static BoolConverters.And}">
                                    <Binding Path="IsPackageOpen" />
                                    <Binding Path="$parent[SplitView].IsPaneOpen" />
                                </MultiBinding>
                            </StackPanel.IsVisible>
                            <ToggleButton Command="{Binding GoPackages}"
                                          HorizontalAlignment="Stretch" Background="Transparent"
                                          IsChecked="{Binding ActiveMenu,
        Converter={StaticResource EnumEqualsConverter},
        ConverterParameter={x:Static enums:MenuOptions.InstallPackage}}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <icons:MaterialIcon Kind="PlusBox" Width="18" Height="18" />
                                    <TextBlock Text="Install Packages" FontSize="13" />
                                </StackPanel>
                            </ToggleButton>
                            <ToggleButton Command="{Binding GoUpdate}"
                                          HorizontalAlignment="Stretch" Background="Transparent"
                                          IsChecked="{Binding ActiveMenu,
        Converter={StaticResource EnumEqualsConverter},
        ConverterParameter={x:Static enums:MenuOptions.UpdatePackage}}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <icons:MaterialIcon Kind="Update" Width="18" Height="18" />
                                    <TextBlock Text="Update Packages" FontSize="13" />
                                </StackPanel>
                            </ToggleButton>
                            <ToggleButton Command="{Binding GoRemove}"
                                          HorizontalAlignment="Stretch" Background="Transparent"
                                          IsChecked="{Binding ActiveMenu,
        Converter={StaticResource EnumEqualsConverter},
        ConverterParameter={x:Static enums:MenuOptions.RemovePackage}}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <icons:MaterialIcon Kind="Delete" Width="18" Height="18" />
                                    <TextBlock Text="Remove Packages" FontSize="13" />
                                </StackPanel>
                            </ToggleButton>
                        </StackPanel>
                        <Button Command="{Binding ToggleAurMenu}"
                                HorizontalAlignment="Stretch"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="0"
                                IsVisible="{Binding IsAurEnabled}">
                            <Grid ColumnDefinitions="66, *" Height="40">
                                <icons:MaterialIcon Kind="Arch" Width="22" Height="22"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center" />
                                <TextBlock Grid.Column="1" Text="AUR"
                                           VerticalAlignment="Center"
                                           IsVisible="{Binding $parent[SplitView].IsPaneOpen}" />
                            </Grid>
                        </Button>
                        <StackPanel Margin="25,0,0,10" Spacing="5"
                                    HorizontalAlignment="Left">
                            <StackPanel.IsVisible>
                                <MultiBinding Converter="{x:Static BoolConverters.And}">
                                    <Binding Path="IsAurOpen" />
                                    <Binding Path="$parent[SplitView].IsPaneOpen" />
                                </MultiBinding>
                            </StackPanel.IsVisible>
                            <ToggleButton Command="{Binding GoAur}" HorizontalAlignment="Stretch"
                                          Background="Transparent"
                                          IsChecked="{Binding ActiveMenu,
        Converter={StaticResource EnumEqualsConverter},
        ConverterParameter={x:Static enums:MenuOptions.InstallAurPackage}}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <icons:MaterialIcon Kind="PlusBox" Width="18" Height="18" />
                                    <TextBlock Text="Install AUR" FontSize="13" />
                                </StackPanel>
                            </ToggleButton>
                            <ToggleButton Command="{Binding GoAurUpdate}"
                                          HorizontalAlignment="Stretch" Background="Transparent"
                                          IsChecked="{Binding ActiveMenu,
        Converter={StaticResource EnumEqualsConverter},
        ConverterParameter={x:Static enums:MenuOptions.UpdateAurPackage}}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <icons:MaterialIcon Kind="Update" Width="18" Height="18" />
                                    <TextBlock Text="Update AUR" FontSize="13" />
                                </StackPanel>
                            </ToggleButton>
                            <ToggleButton Command="{Binding GoAurRemove}"
                                          HorizontalAlignment="Stretch" Background="Transparent"
                                          IsChecked="{Binding ActiveMenu,
        Converter={StaticResource EnumEqualsConverter},
        ConverterParameter={x:Static enums:MenuOptions.RemoveAurPackage}}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <icons:MaterialIcon Kind="Delete" Width="18" Height="18" />
                                    <TextBlock Text="Remove AUR" FontSize="13" />
                                </StackPanel>
                            </ToggleButton>
                        </StackPanel>
                        <Button Command="{Binding ToggleFlatpakMenu}"
                                HorizontalAlignment="Stretch"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="0"
                                IsVisible="{Binding IsFlatpakEnabled}">
                            <Grid ColumnDefinitions="66, *" Height="40">
                                <PathIcon Data="{StaticResource FlatpakIcon}"
                                          Foreground="{DynamicResource TextControlForeground}"
                                          Width="18" 
                                          Height="18" />
                                <TextBlock Grid.Column="1" Text="Flatpak"
                                           VerticalAlignment="Center"
                                           IsVisible="{Binding $parent[SplitView].IsPaneOpen}" />
                            </Grid>
                        </Button>
                        <StackPanel Margin="25,0,0,10" Spacing="5"
                                    HorizontalAlignment="Left">
                            <StackPanel.IsVisible>
                                <MultiBinding Converter="{x:Static BoolConverters.And}">
                                    <Binding Path="IsFlatpakOpen" />
                                    <Binding Path="$parent[SplitView].IsPaneOpen" />
                                </MultiBinding>
                            </StackPanel.IsVisible>
                            <ToggleButton Command="{Binding GoFlatpak}" HorizontalAlignment="Stretch"
                                          Background="Transparent"
                                          IsChecked="{Binding ActiveMenu,
        Converter={StaticResource EnumEqualsConverter},
        ConverterParameter={x:Static enums:MenuOptions.InstallFlatpak}}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <icons:MaterialIcon Kind="PlusBox" Width="18" Height="18" />
                                    <TextBlock Text="Install Flatpak" FontSize="13" />
                                </StackPanel>
                            </ToggleButton>
                            <ToggleButton Command="{Binding GoFlatpakUpdate}"
                                          HorizontalAlignment="Stretch" Background="Transparent"
                                          IsChecked="{Binding ActiveMenu,
        Converter={StaticResource EnumEqualsConverter},
        ConverterParameter={x:Static enums:MenuOptions.UpdateFlatpak}}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <icons:MaterialIcon Kind="Update" Width="18" Height="18" />
                                    <TextBlock Text="Update Flatpak" FontSize="13" />
                                </StackPanel>
                            </ToggleButton>
                            <ToggleButton Command="{Binding GoFlatpakRemove}"
                                          HorizontalAlignment="Stretch" Background="Transparent"
                                          IsChecked="{Binding ActiveMenu,
        Converter={StaticResource EnumEqualsConverter},
        ConverterParameter={x:Static enums:MenuOptions.RemoveFlatpak}}">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <icons:MaterialIcon Kind="Delete" Width="18" Height="18" />
                                    <TextBlock Text="Remove Flatpak" FontSize="13" />
                                </StackPanel>
                            </ToggleButton>
                        </StackPanel>
                    </StackPanel>
                    <Button Command="{Binding GoSetting}"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Bottom"
                            Background="Transparent"
                            BorderThickness="0"
                            Padding="0">
                        <Grid ColumnDefinitions="66, *" Height="48" Background="Transparent">
                            <icons:MaterialIcon Kind="Settings" Width="24" Height="24" HorizontalAlignment="Center"
                                                VerticalAlignment="Center" />
                            <TextBlock Grid.Column="1" Text="Settings" VerticalAlignment="Center"
                                       IsVisible="{Binding $parent[SplitView].IsPaneOpen}" />
                        </Grid>
                    </Button>

                </Grid>
            </SplitView.Pane>
            <avalonia:RoutedViewHost Router="{Binding Router}" PageTransition="{x:Null}">
                <avalonia:RoutedViewHost.DefaultContent>
                    <TextBlock Text="Default content"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center" />
                </avalonia:RoutedViewHost.DefaultContent>
                <avalonia:RoutedViewHost.ViewLocator>
                    <shellyUi:ViewLocator />
                </avalonia:RoutedViewHost.ViewLocator>
            </avalonia:RoutedViewHost>
        </SplitView>
        <Panel IsVisible="{Binding IsProcessing}" Background="#80000000">
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                    CornerRadius="12"
                    Padding="30"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    MinWidth="400"
                    BoxShadow="0 8 32 0 #60000000">
                <StackPanel Spacing="20">
                    <TextBlock Text="Package Operations"
                               FontSize="20"
                               FontWeight="Bold"
                               HorizontalAlignment="Center" />

                    <ProgressBar Value="{Binding ProgressValue}"
                                 IsIndeterminate="{Binding ProgressIndeterminate}"
                                 Height="8"
                                 Minimum="0"
                                 Maximum="100"
                                 CornerRadius="4" />

                    <TextBlock Text="{Binding ProcessingMessage}"
                               HorizontalAlignment="Center"
                               FontSize="14"
                               TextWrapping="Wrap"
                               TextAlignment="Center" />
                </StackPanel>
            </Border>
        </Panel>
        <Panel IsVisible="{Binding ShowQuestion}" Background="#80000000">
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                    CornerRadius="12"
                    Padding="30"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    MinWidth="400"
                    MaxWidth="600"
                    BoxShadow="0 8 32 0 #60000000">
                <StackPanel Spacing="20">
                    <TextBlock Text="{Binding QuestionTitle}"
                               FontSize="20"
                               FontWeight="Bold"
                               HorizontalAlignment="Center" />

                    <TextBlock Text="{Binding QuestionText}"
                               HorizontalAlignment="Center"
                               FontSize="14"
                               TextWrapping="Wrap"
                               TextAlignment="Center" />

                    <!-- Yes/No buttons for regular questions -->
                    <StackPanel Orientation="Horizontal" Spacing="20" HorizontalAlignment="Center"
                                IsVisible="{Binding !IsSelectProviderQuestion}">
                        <Button Content="Yes"
                                Command="{Binding RespondToQuestion}"
                                CommandParameter="1"
                                Width="100"
                                HorizontalContentAlignment="Center" />
                        <Button Content="No"
                                Command="{Binding RespondToQuestion}"
                                CommandParameter="0"
                                Width="100"
                                HorizontalContentAlignment="Center" />
                    </StackPanel>

                    <!-- Provider selection for SelectProvider questions -->
                    <StackPanel Spacing="15" IsVisible="{Binding IsSelectProviderQuestion}">
                        <ListBox ItemsSource="{Binding ProviderOptions}"
                                 SelectedIndex="{Binding SelectedProviderIndex}"
                                 MaxHeight="200"
                                 MinWidth="300">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" Padding="10,5" />
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                        <Button Content="Select"
                                Command="{Binding RespondToQuestion}"
                                CommandParameter="{Binding SelectedProviderIndex}"
                                HorizontalAlignment="Center"
                                Width="120"
                                HorizontalContentAlignment="Center" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Panel>
        <Panel IsVisible="{Binding IsSettingsOpen}">
            <Panel Background="#80000000"
                   PointerPressed="OnBackdropPressed">
                <Panel.Effect>
                    <BlurEffect Radius="10" />
                </Panel.Effect>
            </Panel>
            <Border Padding="100">
                <Grid>
                    <Border
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch"
                        CornerRadius="24"
                        BorderBrush="{DynamicResource SystemChromeHighColor}"
                        BorderThickness="2"
                        ClipToBounds="True">
                        <Border CornerRadius="24" ClipToBounds="True">
                            <avalonia:RoutedViewHost
                                Router="{Binding SettingRouter}"
                                PageTransition="{x:Null}">
                                <avalonia:RoutedViewHost.ViewLocator>
                                    <shellyUi:ViewLocator />
                                </avalonia:RoutedViewHost.ViewLocator>
                            </avalonia:RoutedViewHost>
                        </Border>
                    </Border>
                    <Button Content="✕"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top"
                            Margin="10"
                            Width="32"
                            Height="32"
                            FontSize="18"
                            Command="{Binding CloseSettingsCommand}"
                            Background="Transparent"
                            CornerRadius="4"
                            BorderThickness="0" />
                </Grid>
            </Border>
        </Panel>
        <Panel IsVisible="{Binding ShowPasswordPrompt}" Background="#80000000">
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                    CornerRadius="12"
                    Padding="30"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    MinWidth="400"
                    MaxWidth="500"
                    BoxShadow="0 8 32 0 #60000000">
                <StackPanel Spacing="20">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="10">
                        <icons:MaterialIcon Kind="ShieldLock" Width="28" Height="28" />
                        <TextBlock Text="Authentication Required"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center" />
                    </StackPanel>

                    <TextBlock Text="{Binding PasswordPromptReason, StringFormat='Action: {0}'}"
                               HorizontalAlignment="Center"
                               FontSize="14"
                               TextWrapping="Wrap"
                               TextAlignment="Center"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />

                    <TextBlock
                        Text="Enter your password to continue. Your password will be remembered for this session. Multiple failed attempts may cause a lockout."
                        HorizontalAlignment="Center"
                        FontSize="12"
                        TextWrapping="Wrap"
                        TextAlignment="Center"
                        Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />

                    <TextBox Watermark="Password"
                             PasswordChar="●"
                             Text="{Binding PasswordInput}"
                             HorizontalAlignment="Stretch">
                        <TextBox.KeyBindings>
                            <KeyBinding
                                Gesture="Enter"
                                Command="{Binding SubmitPasswordCommand}" />
                        </TextBox.KeyBindings>
                    </TextBox>
                    <TextBlock Text="{Binding PasswordErrorMessage}"
                               Foreground="IndianRed"
                               FontSize="12"
                               HorizontalAlignment="Center"
                               IsVisible="{Binding PasswordErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                    <StackPanel Orientation="Horizontal" Spacing="20" HorizontalAlignment="Center">
                        <Button Content="Authenticate"
                                Command="{Binding SubmitPasswordCommand}"
                                Width="120"
                                HorizontalContentAlignment="Center" />
                        <Button Content="Cancel"
                                Command="{Binding CancelPasswordCommand}"
                                Width="100"
                                HorizontalContentAlignment="Center" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Panel>
        <Panel IsVisible="{Binding IsGlobalBusy}" Background="#CC000000">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="20">
                <TextBlock Text="{Binding GlobalProgressText}"
                           Foreground="White"
                           HorizontalAlignment="Right"
                           FontSize="12"
                           Margin="0,-15,0,0" />
                <ProgressBar Value="{Binding GlobalProgressValue}"
                             Minimum="0" Maximum="100"
                             Width="300" Height="8" CornerRadius="4" />
                <TextBlock Text="{Binding GlobalBusyMessage}"
                           Foreground="White"
                           FontSize="16"
                           HorizontalAlignment="Center" />
            </StackPanel>
        </Panel>
        <!-- Action Toast Notification -->
        <Border x:Name="ActionToastBorder"
                IsVisible="{Binding ShowActionToast}"
                HorizontalAlignment="Left"
                VerticalAlignment="Bottom"
                Margin="20"
                Padding="16,12"
                CornerRadius="8"
                MinWidth="250"
                MaxWidth="400"
                BoxShadow="0 4 16 0 #40000000"
                Classes.success="{Binding ActionToastIsSuccess}"
                Classes.error="{Binding !ActionToastIsSuccess}">
            <Border.Styles>
                <Style Selector="Border.success">
                    <Setter Property="Background" Value="{Binding SuccessColor}" />
                </Style>
                <Style Selector="Border.error">
                    <Setter Property="Background" Value="#C62828" />
                </Style>
            </Border.Styles>
            <Grid ColumnDefinitions="Auto,*,Auto">
                <icons:MaterialIcon Grid.Column="0"
                                    Width="20" Height="20"
                                    Margin="0,0,12,0"
                                    VerticalAlignment="Center"
                                    Foreground="White"
                                    Kind="CheckCircle"
                                    IsVisible="{Binding ActionToastIsSuccess}" />
                <icons:MaterialIcon Grid.Column="0"
                                    Width="20" Height="20"
                                    Margin="0,0,12,0"
                                    VerticalAlignment="Center"
                                    Foreground="White"
                                    Kind="AlertCircle"
                                    IsVisible="{Binding !ActionToastIsSuccess}" />
                <TextBlock Grid.Column="1"
                           Text="{Binding ActionToastMessage}"
                           Foreground="White"
                           FontSize="14"
                           TextWrapping="Wrap"
                           VerticalAlignment="Center" />
                <Button Grid.Column="2"
                        Content="✕"
                        Background="Transparent"
                        Foreground="White"
                        BorderThickness="0"
                        Padding="8,4"
                        Margin="8,0,0,0"
                        VerticalAlignment="Center"
                        Command="{Binding DismissToastCommand}" />
            </Grid>
        </Border>
    </Grid>
</Window>